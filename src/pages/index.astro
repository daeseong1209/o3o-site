---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts', ({ data }) => !data.draft))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 5);

const formatDate = (date: Date) =>
	new Intl.DateTimeFormat('en-CA', {
		year: 'numeric',
		month: '2-digit',
		day: '2-digit',
		timeZone: 'UTC',
	}).format(date);
---

<Layout title="o3o.team" description="o3o.team blog">
	<section class="hero">
		<p class="kicker">Team logbook</p>
		<h1>o3o.team</h1>
		<p>Notes, updates, and writeups. Calm UI, fast publishing.</p>
		<p class="hero-links">
			<a class="button" href="/blog">Read the blog</a>
			<a class="button secondary" href="/admin" rel="nofollow">Open CMS</a>
		</p>
	</section>

	<section class="home-grid">
		<div class="card">
			<h2>What is this?</h2>
			<p class="muted">
				A small team blog powered by Astro + Decap CMS (GitHub PR workflow).
			</p>
		</div>
		<div class="card">
			<h2>Quick links</h2>
			<div class="link-list">
				<a href="/blog">Browse posts</a>
				<a href="/admin" rel="nofollow">Write in CMS</a>
				<a href="https://github.com/daeseong1209/o3o-site" rel="nofollow">GitHub repo</a>
			</div>
		</div>
	</section>

	<section>
		<h2>Latest</h2>
		{posts.length === 0 ? (
			<p>No posts yet.</p>
		) : (
			<ul class="post-list">
				{posts.map((post) => (
					<li>
						<a class="post-title" href={`/blog/${post.slug}/`}>{post.data.title}</a>
						<div class="post-meta">
							<time class="muted" datetime={post.data.pubDate.toISOString()}>
								{formatDate(post.data.pubDate)}
							</time>
							{post.data.tags?.length ? (
								<div class="pill-row">
									{post.data.tags.slice(0, 4).map((t) => (
										<span class="pill">{t}</span>
									))}
								</div>
							) : null}
						</div>
						{post.data.description ? <p>{post.data.description}</p> : null}
					</li>
				))}
			</ul>
		)}
	</section>
</Layout>
